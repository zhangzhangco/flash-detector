# è§†é¢‘é—ªå…‰æ£€æµ‹å·¥å…· (Video Flash Detector)

ä¸€ä¸ªåŸºäºPythonçš„è§†é¢‘é—ªå…‰æ£€æµ‹å·¥å…·ï¼Œå¯ä»¥è‡ªåŠ¨è¯†åˆ«è§†é¢‘ä¸­çš„é—ªå…‰åºåˆ—ï¼Œæ”¯æŒå‘½ä»¤è¡Œå’Œå›¾å½¢ç•Œé¢ä¸¤ç§ä½¿ç”¨æ–¹å¼ã€‚

## åŠŸèƒ½ç‰¹ç‚¹

- ğŸ¯ å‡†ç¡®æ£€æµ‹è§†é¢‘ä¸­çš„é—ªå…‰åºåˆ—
- ğŸ–¼ï¸ æ”¯æŒå¤šç§å¯è§†åŒ–æ–¹å¼ï¼ˆåŸå§‹å¸§ã€çƒ­åŠ›å›¾ã€åŒºåŸŸæ”¾å¤§ï¼‰
- ğŸ”„ ä½¿ç”¨ç¯å½¢ç¼“å†²åŒºå®ç°å®æ—¶æ£€æµ‹
- ğŸ“Š æä¾›è¯¦ç»†çš„æ£€æµ‹ç»“æœå’Œæ€§èƒ½ç»Ÿè®¡
- ğŸ›ï¸ ä¸°å¯Œçš„å‚æ•°è°ƒæ•´é€‰é¡¹
- ğŸ’» åŒæ—¶æ”¯æŒå‘½ä»¤è¡Œå’ŒGUIç•Œé¢

## ç›®å½•ç»“æ„

flash_detector/
â”œâ”€â”€ README.md
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ setup.py
â”œâ”€â”€ src/
â”‚ â””â”€â”€ flash_detector/
â”‚ â”œâ”€â”€ init.py
â”‚ â”œâ”€â”€ core/ # æ ¸å¿ƒæ£€æµ‹ç®—æ³•
â”‚ â”‚ â”œâ”€â”€ detector.py
â”‚ â”‚ â””â”€â”€ utils.py
â”‚ â”œâ”€â”€ visualization/ # å¯è§†åŒ–å·¥å…·
â”‚ â”‚ â””â”€â”€ visualizer.py
â”‚ â”œâ”€â”€ interface/ # ç”¨æˆ·ç•Œé¢
â”‚ â”‚ â”œâ”€â”€ cli.py
â”‚ â”‚ â””â”€â”€ gui.py
â”‚ â””â”€â”€ main.py
â”œâ”€â”€ tests/ # æµ‹è¯•ç”¨ä¾‹
â”‚ â”œâ”€â”€ test_detector.py
â”‚ â””â”€â”€ test_utils.py
â””â”€â”€ examples/ # ä½¿ç”¨ç¤ºä¾‹
â”œâ”€â”€ sample_videos/
â””â”€â”€ demo.ipynb

## å®‰è£…æ–¹æ³•

### ç¯å¢ƒè¦æ±‚
- Python 3.8+
- OpenCV 4.5+
- NumPy 1.19+
- Gradio 3.x
- psutil 5.8+
- pytest 6.0+ (ç”¨äºå¼€å‘)

### å®‰è£…æ­¥éª¤

1. å…‹éš†ä»“åº“
```bash
git clone https://github.com/yourusername/flash_detector.git
cd flash_detector
```
2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
```bash
python -m venv venv
source venv/bin/activate # Linux/Mac
```
æˆ–
```bash
venv\Scripts\activate # Windows
```
3. å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

4. å®‰è£…é¡¹ç›®
```bash
pip install -e .
```

## ä½¿ç”¨æ–¹æ³•

### å‘½ä»¤è¡Œæ¨¡å¼

åŸºæœ¬ä½¿ç”¨ï¼š
```bash
python -m flash_detector video_path [options]
```

å®Œæ•´å‚æ•°è¯´æ˜ï¼š
å‚æ•°ï¼š
video_path è§†é¢‘æ–‡ä»¶è·¯å¾„
--abs_threshold ç»å¯¹å·®å¼‚é˜ˆå€¼ (é»˜è®¤: 20)
--rel_threshold ç›¸å¯¹å˜åŒ–é˜ˆå€¼ (é»˜è®¤: 0.3)
--region_size æ£€æµ‹åŒºåŸŸå¤§å° (é»˜è®¤: 20)
--frame_step å¸§æ¯”è¾ƒæ­¥é•¿ (é»˜è®¤: 1)
--start_time å¼€å§‹æ—¶é—´ (é»˜è®¤: "0:00")
--circularity_threshold åœ†å½¢åº¦é˜ˆå€¼ (é»˜è®¤: 0.5)

ç¤ºä¾‹ï¼š
åŸºæœ¬ä½¿ç”¨
```bash
python -m flash_detector video.mp4
```
è°ƒæ•´å‚æ•°
```bash
python -m flash_detector video.mp4 --abs_threshold 15 --rel_threshold 0.25
```
æŒ‡å®šå¼€å§‹æ—¶é—´
```bash
python -m flash_detector video.mp4 --start_time "1:30"
```
### å›¾å½¢ç•Œé¢æ¨¡å¼

å¯åŠ¨GUIï¼š
```bash
python -m flash_detector
```
### Python APIä½¿ç”¨

```python
from flash_detector.core.detector import detect_flash
```
æ£€æµ‹è§†é¢‘ä¸­çš„é—ªå…‰
```python
results = detect_flash(
video_path="video.mp4",
abs_threshold=20,
rel_threshold=0.3,
region_size=20,
frame_step=1,
start_time="0:00",
circularity_threshold=0.5
)
```
å¤„ç†ç»“æœ
```python
if results:
flash_info, debug_images = results
frame_num, intensity, position = flash_info
print(f"æ£€æµ‹åˆ°é—ªå…‰ï¼šå¸§å· {frame_num}, å¼ºåº¦ {intensity}, ä½ç½® {position}")
```

## å‚æ•°è°ƒä¼˜å»ºè®®

1. **ç»å¯¹å·®å¼‚é˜ˆå€¼** (15-25)
   - è¾ƒä½ï¼šå¢åŠ æ£€æµ‹çµæ•åº¦ï¼Œå¯èƒ½äº§ç”Ÿè¯¯æŠ¥
   - è¾ƒé«˜ï¼šå‡å°‘è¯¯æŠ¥ï¼Œå¯èƒ½æ¼æ£€
   - å»ºè®®å€¼ï¼š20

2. **ç›¸å¯¹å˜åŒ–é˜ˆå€¼** (0.3)
   - è¾ƒä½ï¼ˆ<0.3ï¼‰ï¼šé€‚åˆæ£€æµ‹å¾®å¼±é—ªå…‰
   - è¾ƒé«˜ï¼ˆ>0.3ï¼‰ï¼šåªæ£€æµ‹æ˜æ˜¾é—ªå…‰
   - å»ºè®®å€¼ï¼š0.3ï¼ˆè¡¨ç¤º30%å˜åŒ–ï¼‰

3. **åœ†å½¢åº¦é˜ˆå€¼** (0.5)
   - è¾ƒä½ï¼šæ”¾å®½å½¢çŠ¶é™åˆ¶
   - è¾ƒé«˜ï¼šä¸¥æ ¼é™åˆ¶ä¸ºåœ†å½¢
   - å»ºè®®å€¼ï¼š0.5-0.7

4. **æ£€æµ‹åŒºåŸŸå¤§å°** (20)
   - è¾ƒå°ï¼ˆ10-15ï¼‰ï¼šé€‚åˆå°èŒƒå›´é—ªå…‰
   - è¾ƒå¤§ï¼ˆ25-30ï¼‰ï¼šé€‚åˆå¤§èŒƒå›´é—ªå…‰
   - å»ºè®®å€¼ï¼š20

## æ€§èƒ½åŸºå‡†æµ‹è¯•

æµ‹è¯•ç¯å¢ƒï¼š
- CPU: Intel i7-9750H
- RAM: 16GB
- è§†é¢‘åˆ†è¾¨ç‡: 1920x1080
- å¸§ç‡: 30fps

æ€§èƒ½æ•°æ®ï¼š
- å¤„ç†é€Ÿåº¦ï¼šçº¦25-30fps
- å†…å­˜ä½¿ç”¨ï¼š~200MB
- CPUä½¿ç”¨ç‡ï¼š30-40%

## å¸¸è§é—®é¢˜ (FAQ)

1. **Q: ä¸ºä»€ä¹ˆæ£€æµ‹ä¸åˆ°é—ªå…‰ï¼Ÿ**
   - A: å°è¯•é™ä½ç»å¯¹å·®å¼‚é˜ˆå€¼ï¼ˆ--abs_thresholdï¼‰
   - A: æ£€æŸ¥è§†é¢‘è´¨é‡å’Œé—ªå…‰æ˜¯å¦æ˜æ˜¾
   - A: ç¡®ä¿æ£€æµ‹åŒºåŸŸå¤§å°åˆé€‚

2. **Q: ç¨‹åºè¿è¡Œå¾ˆæ…¢ï¼Ÿ**
   - A: å¢åŠ å¸§æ­¥é•¿ï¼ˆ--frame_stepï¼‰
   - A: å‡å°æ£€æµ‹åŒºåŸŸå¤§å°
   - A: æ£€æŸ¥ç³»ç»Ÿèµ„æºå ç”¨

3. **Q: å‡ºç°è¯¯æŠ¥ï¼Ÿ**
   - A: æé«˜ç»å¯¹å·®å¼‚é˜ˆå€¼
   - A: æé«˜åœ†å½¢åº¦é˜ˆå€¼
   - A: å¢åŠ ç›¸å¯¹å˜åŒ–é˜ˆå€¼

## å¼€å‘æŒ‡å—

### è¿è¡Œæµ‹è¯•
å®‰è£…å¼€å‘ä¾èµ–
```bash
pip install pytest
```
è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
pytest tests/
```
è¿è¡Œç‰¹å®šæµ‹è¯•
```bash
pytest tests/test_detector.py
```

### ä»£ç é£æ ¼
- éµå¾ªPEP 8è§„èŒƒ
- ä½¿ç”¨ç±»å‹æ³¨è§£
- æ·»åŠ è¯¦ç»†çš„æ–‡æ¡£å­—ç¬¦ä¸²

## å¼€å‘è®¡åˆ’

- [ ] æ”¯æŒæ‰¹é‡è§†é¢‘å¤„ç†
- [ ] æ·»åŠ æ·±åº¦å­¦ä¹ æ¨¡å‹æ”¯æŒ
- [ ] ä¼˜åŒ–æ£€æµ‹é€Ÿåº¦
- [ ] æ·»åŠ æ›´å¤šå¯è§†åŒ–é€‰é¡¹
- [ ] æ”¯æŒå®æ—¶è§†é¢‘æµå¤„ç†
- [ ] æ·»åŠ GUIé…ç½®ä¿å­˜åŠŸèƒ½

## è´¡çŒ®æŒ‡å—

1. Forkæœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. åˆ›å»ºPull Request

### æäº¤PRå‰æ£€æŸ¥æ¸…å•
- [ ] æ›´æ–°äº†æ–‡æ¡£
- [ ] æ·»åŠ äº†æµ‹è¯•ç”¨ä¾‹
- [ ] é€šè¿‡äº†æ‰€æœ‰æµ‹è¯•
- [ ] ä»£ç ç¬¦åˆPEP 8è§„èŒƒ

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## è‡´è°¢

- OpenCVå›¢é˜Ÿ
- Gradioå¼€å‘å›¢é˜Ÿ
- NumPyå›¢é˜Ÿ
- æ‰€æœ‰è´¡çŒ®è€…

## æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-10)
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- æ”¯æŒGUIå’Œå‘½ä»¤è¡Œæ¨¡å¼
- å®ç°åŸºæœ¬çš„é—ªå…‰æ£€æµ‹åŠŸèƒ½
